# LM Light ユーザー権限一覧

## 概要

LM Light には3つのユーザーロールがあります：

| ロール | 説明 |
|--------|------|
| **ADMIN** | システム管理者。全機能にアクセス可能 |
| **SUPER** | 共有管理者。ユーザーへのタグ付与とタグ管理が可能 |
| **USER** | 一般ユーザー。基本機能のみ |

---

## 機能別権限マトリックス

### メイン機能

| 機能 | ADMIN | SUPER | USER |
|------|:-----:|:-----:|:----:|
| チャット | ✅ | ✅ | ✅ |
| RAG (Bot作成・利用) | ✅ | ✅ | ✅ |
| ドキュメント生成 | ✅ | ✅ | ✅ |
| ベンチマーク | ✅ | ✅ | ✅ |
| チャット履歴（自分） | ✅ | ✅ | ✅ |
| モデル学習 | ✅ | ✅ | ✅ |
| ユーザー設定 | ✅ | ✅ | ✅ |

### 管理機能

| 機能 | ADMIN | SUPER | USER |
|------|:-----:|:-----:|:----:|
| 管理メニュー表示 | ✅ | ✅ (制限あり) | ❌ |
| ユーザー一覧表示 | ✅ | ✅ | ❌ |
| ユーザー新規作成 | ✅ | ❌ | ❌ |
| ユーザー情報編集 | ✅ | ❌ | ❌ |
| ユーザーのタグ編集 | ✅ | ✅ | ❌ |
| ユーザー削除 | ✅ | ❌ | ❌ |
| タグ一覧表示 | ✅ | ✅ | ❌ |
| タグ作成 | ✅ | ✅ | ❌ |
| タグ編集 | ✅ | ✅ | ❌ |
| タグ削除 | ✅ | ✅ | ❌ |
| 全ユーザー履歴閲覧 | ✅ | ❌ | ❌ |
| ライセンス管理 | ✅ | ❌ | ❌ |

---

## ロール別詳細

### ADMIN（システム管理者）

**サイドバーメニュー:**
- メインメニュー（全て）
- 管理者メニュー
  - ユーザー一覧
  - 履歴管理
  - 共有管理
  - ライセンス

**できること:**
- 全ユーザーの作成・編集・削除
- 全ユーザーの権限（ロール）変更
- 全ユーザーのパスワードリセット
- タグの作成・編集・削除
- 全ユーザーのチャット履歴閲覧
- ライセンス情報の確認

**制限事項:**
- 自分自身のアカウントは削除不可
- 最後のADMINの権限変更・削除は不可

---

### SUPER（共有管理者）

**サイドバーメニュー:**
- メインメニュー（全て）
- 共有管理メニュー
  - ユーザー一覧
  - 共有管理

**できること:**
- ユーザー一覧の閲覧（タグ付与のため）
- ユーザーへのタグ付与・解除
- タグの作成・編集・削除

**できないこと:**
- ユーザーの新規作成
- ユーザー情報（名前・メール・パスワード）の編集
- ユーザーの権限（ロール）変更
- ユーザーの削除
- 全ユーザーのチャット履歴閲覧
- ライセンス管理

---

### USER（一般ユーザー）

**サイドバーメニュー:**
- メインメニュー（全て）

**できること:**
- チャット機能の利用
- RAG Bot の作成・利用
- ドキュメント生成
- ベンチマーク実行
- 自分のチャット履歴閲覧
- モデル学習
- 自分のユーザー設定変更

**できないこと:**
- 管理メニューへのアクセス
- 他ユーザーの情報閲覧・編集
- タグの管理

---

## API エンドポイント別権限

### ユーザー管理 API

| エンドポイント | メソッド | ADMIN | SUPER | USER |
|---------------|---------|:-----:|:-----:|:----:|
| `/api/admin/users` | GET | ✅ | ✅ | ❌ |
| `/api/admin/users` | POST | ✅ | ❌ | ❌ |
| `/api/admin/users/[id]` | GET | ✅ | ✅ | ❌ |
| `/api/admin/users/[id]` | PATCH | ✅ | ✅ (タグのみ) | ❌ |
| `/api/admin/users/[id]` | DELETE | ✅ | ❌ | ❌ |

### タグ管理 API

| エンドポイント | メソッド | ADMIN | SUPER | USER |
|---------------|---------|:-----:|:-----:|:----:|
| `/api/admin/tags` | GET | ✅ | ✅ | ❌ |
| `/api/admin/tags` | POST | ✅ | ✅ | ❌ |
| `/api/admin/tags/[id]` | GET | ✅ | ✅ | ❌ |
| `/api/admin/tags/[id]` | PATCH | ✅ | ✅ | ❌ |
| `/api/admin/tags/[id]` | DELETE | ✅ | ✅ | ❌ |

### 履歴・ライセンス管理 API

| エンドポイント | メソッド | ADMIN | SUPER | USER |
|---------------|---------|:-----:|:-----:|:----:|
| `/api/admin/chats` | GET | ✅ | ❌ | ❌ |
| `/api/admin/license` | GET | ✅ | ❌ | ❌ |

---

## 保護ルール

### 最後のADMIN保護

システムには必ず1人以上のADMINが必要です。

- 最後のADMINの権限を変更しようとするとエラー:
  `"最後の管理者の権限を変更できません"`

- 最後のADMINを削除しようとするとエラー:
  `"最後の管理者を削除できません"`

### 自己削除防止

ADMINは自分自身のアカウントを削除できません。

- 自分を削除しようとするとエラー:
  `"Cannot delete your own account"`

---

## ユースケース例

### 組織での運用例

```
ADMIN (IT管理者)
├── ユーザーアカウント管理
├── ライセンス管理
└── システム全体の監視

SUPER (部門管理者)
├── 部門メンバーへのタグ付与
├── 共有Botの管理用タグ作成
└── 部門内共有設定

USER (一般社員)
├── チャット・RAG利用
├── 共有Botの利用
└── 個人設定のカスタマイズ
```

### タグを使った共有例

1. SUPERが「営業部」タグを作成
2. SUPERが営業部メンバーに「営業部」タグを付与
3. USERが Bot を作成し、共有設定で「営業部」タグを選択
4. 「営業部」タグを持つユーザーのみがその Bot を利用可能